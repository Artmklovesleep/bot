{"version":3,"file":"index-DkenPO4L.js","sources":["../../../../stores/cart.ts","../../../../pages/index.vue"],"sourcesContent":["// stores/cart.ts\r\n\r\nimport { defineStore } from 'pinia';\r\n\r\ninterface CartItem {\r\n    id: number;\r\n    title: string;\r\n    price: number;\r\n    quantity: number;\r\n}\r\n\r\nexport const useCartStore = defineStore('cart', {\r\n    state: () => ({\r\n        items: [] as CartItem[],\r\n    }),\r\n    getters: {\r\n        totalItems(): number {\r\n            return this.items.reduce((total, item) => total + item.quantity, 0);\r\n        },\r\n        totalPrice(): number {\r\n            return this.items.reduce((total, item) => total + item.price * item.quantity, 0);\r\n        },\r\n    },\r\n    actions: {\r\n        addItem(item: CartItem) {\r\n            const existingItem = this.items.find((i) => i.id === item.id);\r\n            if (existingItem) {\r\n                existingItem.quantity += item.quantity;\r\n            } else {\r\n                this.items.push(item);\r\n            }\r\n        },\r\n        removeItem(itemId: number) {\r\n            this.items = this.items.filter((item) => item.id !== itemId);\r\n        },\r\n        clearCart() {\r\n            this.items = [];\r\n        },\r\n        updateItemQuantity(itemId: number, quantity: number) {\r\n            const item = this.items.find((i) => i.id === itemId);\r\n            if (item) {\r\n                item.quantity = quantity;\r\n            }\r\n            if (item?.quantity == 0) {\r\n                this.removeItem(itemId);\r\n            }\r\n        },\r\n    },\r\n});","<template>\r\n    <div class=\"flex h-screen\">\r\n        <div class=\"grow h-screen overflow-y-auto p-4\">\r\n            <div v-if=\"loading\" class=\"flex justify-center items-center h-full animate__animated animate__fadeIn\">\r\n                <div class=\"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900\"></div>\r\n            </div>\r\n            <div v-else>\r\n                <div class=\"\">\r\n                    <div\r\n                        class=\"mt-2 pt-4 absolute top-0 left-0 w-full z-10 bg-pale-sky-100 dark:bg-pale-sky-800 rounded-full shadow-lg shadow-pale-sky-500/20\">\r\n                        <div class=\"flex flex-wrap\">\r\n                            <button v-if=\"categories.count > 0\" v-for=\"category in categories.results\"\r\n                                :key=\"category.id\" @click=\"selectedCategory = category.id\"\r\n                                class=\"text-center bg-transparent hover:bg-pale-sky-200 my-auto shadow-lg dark:shadow-neutral-700/50 text-black-700 font-semibold p-1 border-2 border-pale-sky-900 dark:border-neutral-400 hover:dark:bg-neutral-500 rounded-lg animate__animated hovanimate__swing ml-3 mb-3\"\r\n                                :class=\"{ 'bg-neutral-400 dark:bg-pale-sky-600': category.id === selectedCategory }\">\r\n                                {{ category.title }}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"mt-16 grid grid-cols-2 gap-x-6 gap-y-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 mb-16\">\r\n                    <div v-if=\"filteredProducts.length !== 0\" v-for=\"product in filteredProducts\" :key=\"product.id\"\r\n                        class=\"group relative bg-pale-sky-200 dark:bg-pale-sky-800 p-3 rounded-md\">\r\n                        <a href=\"\" class=\"animate__animated animate__fadeIn\" @click.prevent=\"openModal(product)\">\r\n                            <carditem :imagesrc=\"'data:image/png;base64,' + product.images\" :title=\"product.title\"\r\n                                :price=\"product.price\" />\r\n\r\n                        </a>\r\n                        <div class=\"flex flex-row-reverse pt-1 animate__animated animate__fadeIn\">\r\n                            <button v-if=\"!product.quantity\" @click=\"product.quantity = 1; addToCart(product);\"\r\n                                class=\"mt-2 py-1 w-full middle none center rounded-full bg-white font-mono font-bold uppercase shadow-md shadow-pale-sky-500/20 transition-all duration-200 hover:shadow-lg active:bg-pale-sky-900 active:text-pale-sky-400 text-black text-2xl\">+</button>\r\n                            <div v-else\r\n                                class=\"mt-2 w-full middle none center rounded-full bg-white font-mono text-xs font-bold uppercase text-white shadow-md shadow-pale-sky-500/20 transition-all hover:shadow-lg\">\r\n                                <div class=\"flex flex-row justify-between px-2\">\r\n                                    <button @click=\"product.quantity--; updateQuantityGood(product)\"\r\n                                        class=\"w-8 text-black bg-white text-2xl my-1 rounded-full hover:bg-black hover:text-white transition-all duration-300 ease-in-out\">-</button>\r\n                                    <label\r\n                                        class=\"block font-medium text-gray-900 my-auto text-xl animate__animated animate__fadeIn\"\r\n                                        for=\"quantity\">{{ product.quantity }}</label>\r\n                                    <button @click=\"product.quantity++; updateQuantityGood(product)\"\r\n                                        class=\"w-8 text-black bg-white text-2xl my-1 rounded-full hover:bg-black hover:text-white transition-all duration-300 ease-in-out\">+</button>\r\n\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"animate__animated animate__fadeIn\" v-else>Нет данных</div>\r\n                </div>\r\n            </div>\r\n            <div v-if=\"selectedProduct\" class=\"fixed z-10 inset-0 overflow-y-auto animate__animated animate__fadeIn\">\r\n                <div\r\n                    class=\"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0 animate__animated animate__fadeIn \">\r\n                    <div class=\"fixed inset-0 transition-opacity\" aria-hidden=\"true\">\r\n                        <div class=\"absolute inset-0 bg-gray-500 opacity-75\"></div>\r\n                    </div>\r\n                    <span class=\"hidden sm:inline-block sm:align-middle sm:h-screen\" aria-hidden=\"true\">&#8203;</span>\r\n                    <div\r\n                        class=\"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full\">\r\n                        <div class=\"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4\">\r\n                            <div class=\"sm:flex sm:items-center\">\r\n                                <div class=\"mt-3 sm:mt-0 sm:w-1/2 flex justify-center items-center\">\r\n                                    <img :src=\"'data:image/png;base64,' + selectedProduct.images\" class=\"w-full\" />\r\n                                </div>\r\n                                <div class=\"mt-3 sm:mt-0 sm:ml-6 sm:w-1/2\">\r\n                                    <div class=\"mb-4\">\r\n                                        <label for=\"title\"\r\n                                            class=\"block text-sm font-medium text-gray-700\">Название</label>\r\n                                        <input disabled type=\"text\" id=\"title\" v-model=\"selectedProduct.title\"\r\n                                            class=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\">\r\n                                    </div>\r\n                                    <div class=\"mb-4\">\r\n                                        <label for=\"category\"\r\n                                            class=\"block text-sm font-medium text-gray-700\">Категория</label>\r\n                                        <select disabled id=\"category\" v-model=\"selectedProduct.category\"\r\n                                            class=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\">\r\n                                            <option v-for=\"category in categories.results\" :key=\"category.id\"\r\n                                                :value=\"category.id\">{{ category.title }}</option>\r\n                                        </select>\r\n                                    </div>\r\n                                    <div class=\"mb-4\">\r\n                                        <label for=\"price\" class=\"block text-sm font-medium text-gray-700\">Цена</label>\r\n                                        <input disabled type=\"number\" id=\"price\" v-model.number=\"selectedProduct.price\"\r\n                                            class=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\">\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse\">\r\n                            <!-- <button type=\"button\" @click=\"\"\r\n                                class=\"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 sm:ml-3 sm:w-auto sm:text-sm \">\r\n                                Добавить\r\n                            </button> -->\r\n                            <button type=\"button\" @click=\"closeModal\"\r\n                                class=\"my-3 md:my-0 lg:my-0 xl:my-0 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm\">\r\n                                Отмена\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class=\"fixed bottom-0 left-0 w-full p-4\">\r\n        <button @click=\"\"\r\n            class=\"w-full py-3 px-6 bg-pale-sky-800 dark:bg-pale-sky-50 dark:text-black text-white font-semibold rounded-xl hover:bg-pale-sky-700 dark:hover:bg-pale-sky-600 transition duration-200 animate__animated shadow-md shadow-gray-400 dark:shadow-pale-sky-700 hover:shadow-lg\"\r\n            :class=\"{ 'animate__fadeInUp': cartItems.length > 0, 'animate__fadeOutDown': cartItems.length === 0 }\">\r\n            <div class=\"flex flex-row justify-between\">\r\n                <div>40min</div>\r\n                <div>Заказ</div>\r\n                <div>{{ totalPrice }}руб</div>\r\n            </div>\r\n        </button>\r\n    </div>\r\n\r\n    <!-- <div>{{ cartItems.length }}</div> -->\r\n\r\n    <!-- <div v-if=\"cartItems.length > 0\">\r\n        <button class=\"fixed bottom-10 right-10\" @click=\"clearCart\">Очистить корзину</button>\r\n    </div> -->\r\n\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { API } from '~/plugins/axios.js';\r\nimport { ref } from 'vue';\r\nimport carditem from '../components/carditem.vue';\r\nimport { useCartStore } from '~/stores/cart';\r\nimport { storeToRefs } from 'pinia';\r\n\r\ndefinePageMeta({\r\n    layout: \"default\",\r\n});\r\n\r\nuseHead({ title: \"Store\" });\r\n\r\ninterface Product_modal {\r\n    id: number;\r\n    title: string;\r\n    price: number;\r\n    category: number;\r\n    images: string;\r\n    quantity: number;\r\n}\r\n\r\ninterface Product {\r\n    count: number;\r\n    results: {\r\n        id: number;\r\n        title: string;\r\n        price: number;\r\n        category: number;\r\n        images: string;\r\n        quantity: number;\r\n    }[];\r\n}\r\n\r\ninterface Category {\r\n    count: number;\r\n    results: {\r\n        id: number;\r\n        title: string;\r\n    }[];\r\n}\r\n\r\nconst cartStore = useCartStore();\r\nconst { items: cartItems, totalItems, totalPrice } = storeToRefs(cartStore);\r\nconst selectedCategory = ref(0);\r\n\r\nconst loading = ref(true);\r\nconst filteredProducts = ref<Product['results']>([]);\r\nconst selectedProduct = ref<Product_modal | null>(null);\r\n\r\nconst toast = useToast();\r\n\r\nconst products = ref<Product>({\r\n    count: 0,\r\n    results: []\r\n});\r\n\r\nconst categories = ref<Category>({\r\n    count: 0,\r\n    results: []\r\n});\r\n\r\nfunction get_data() {\r\n    Promise.all([\r\n        API.get('categories/'),\r\n        API.get('products/')\r\n    ])\r\n        .then(function ([categoriesResponse, productsResponse]: any) {\r\n            categories.value = categoriesResponse.data;\r\n            products.value = productsResponse.data;\r\n\r\n            if (categories.value.count > 0) {\r\n                selectedCategory.value = categories.value.results[0].id;\r\n                filterProducts();\r\n            } else if (products.value.count > 0) {\r\n                filteredProducts.value = products.value.results;\r\n            }\r\n            loading.value = false;\r\n\r\n        })\r\n        .catch(function (error: any) {\r\n            console.log(error);\r\n            loading.value = true;\r\n        });\r\n}\r\n\r\nfunction filterProducts() {\r\n    if (selectedCategory.value === 0) {\r\n        filteredProducts.value = products.value.results;\r\n    } else {\r\n        filteredProducts.value = products.value.results.filter(product =>\r\n            product.category === selectedCategory.value\r\n        );\r\n    }\r\n}\r\n\r\nwatch(selectedCategory, (newValue) => {\r\n    if (newValue === 0) {\r\n        filteredProducts.value = products.value.results;\r\n    } else {\r\n        filteredProducts.value = products.value.results.filter(product =>\r\n            product.category === newValue\r\n        );\r\n    }\r\n});\r\n\r\nfunction openModal(product: Product_modal) {\r\n    selectedProduct.value = { ...product };\r\n}\r\n\r\nfunction closeModal() {\r\n    selectedProduct.value = null;\r\n}\r\n\r\nfunction addProductToCart() {\r\n    toast.add({\r\n        title: \"Товар успешно добавлен.\",\r\n        timeout: 1000,\r\n        callback: () => {\r\n        },\r\n    });\r\n    // get_data();\r\n}\r\n\r\nfunction addToCart(product: Product_modal) {\r\n    cartStore.addItem({\r\n        id: product.id,\r\n        title: product.title,\r\n        price: product.price,\r\n        quantity: product.quantity,\r\n    });\r\n}\r\n\r\nfunction clearCart() {\r\n    cartStore.clearCart();\r\n    for (let i = 0; i < products.value.count; i++) {\r\n        products.value.results[i].quantity = 0;\r\n    }\r\n}\r\n\r\nfunction updateQuantityGood(product: Product_modal) {\r\n    cartStore.updateItemQuantity(product.id, product.quantity);\r\n}\r\n\r\nget_data();\r\n\r\n\r\n</script>\r\n\r\n<style>\r\nbody {\r\n    font-family: 'Golos Text'\r\n}\r\n\r\n.fade-enter-active,\r\n.fade-leave-active {\r\n    transition: opacity 0.5s;\r\n}\r\n\r\n.fade-enter,\r\n.fade-leave-to {\r\n    opacity: 0;\r\n}\r\n</style>"],"names":[],"mappings":"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"}